unit view.principal;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Vcl.Buttons, Vcl.StdCtrls,
  Data.DB, Vcl.Grids, Vcl.DBGrids, view.modal.nova.transação, view.fundo,
  service.conexao, Vcl.Imaging.pngimage;

type
  TViewPrincipal = class(TForm)
    pnlHeader: TPanel;
    pnlFooter: TPanel;
    pnlContent: TPanel;
    pnlNovaTransação: TPanel;
    pnlBtnNovaTransação: TPanel;
    btnNovaTransação: TSpeedButton;
    pnlLogo: TPanel;
    imgLogo: TImage;
    lblLogo: TLabel;
    pnlSaldos: TPanel;
    pnlGrid: TPanel;
    DBGrid: TDBGrid;
    btnClose: TSpeedButton;
    DataSource: TDataSource;
    pnlEntradas: TPanel;
    pnlSaidas: TPanel;
    pnlTotal: TPanel;
    lblEntradas: TLabel;
    lblSaidas: TLabel;
    lblTotal: TLabel;
    lblValorEntradas: TLabel;
    lblValorSaidas: TLabel;
    lblValorTotal: TLabel;
    SpeedButton1: TSpeedButton;
    procedure btnNovaTransaçãoClick(Sender: TObject);
    procedure btnCloseClick(Sender: TObject);
    procedure DBGridDrawColumnCell(Sender: TObject; const Rect: TRect;
      DataCol: Integer; Column: TColumn; State: TGridDrawState);
    procedure SpeedButton1Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  ViewPrincipal: TViewPrincipal;

implementation

{$R *.dfm}

procedure TViewPrincipal.btnCloseClick(Sender: TObject);
begin
  Self.Close;
end;

procedure TViewPrincipal.btnNovaTransaçãoClick(Sender: TObject);
begin
  ViewModal := TViewModal.Create(Self);
  try
    ViewFundo.Show;
    ViewModal.ShowModal;
  finally
    ViewFundo.Hide;
    FreeAndNil(ViewModal);
  end;
end;

procedure TViewPrincipal.DBGridDrawColumnCell(Sender: TObject;
  const Rect: TRect; DataCol: Integer; Column: TColumn; State: TGridDrawState);
begin
  if gdSelected in State then
  begin
    // Define a cor de fundo da célula selecionada
    DBGrid.Canvas.Brush.Color := clBtnFace;  // Cor de fundo (cor do item selecionado)

    // Define a cor do texto da célula selecionada
    DBGrid.Canvas.Font.Color := clWindowText;  // Cor do texto (branco, para contraste)
  end
  else
  begin
    // Para células não selecionadas, você pode definir uma cor padrão
    DBGrid.Canvas.Brush.Color := clWindow;  // Cor de fundo padrão
    DBGrid.Canvas.Font.Color := clWindowText;  // Cor do texto padrão
  end;

  // Desenha a célula
  DBGrid.DefaultDrawColumnCell(Rect, DataCol, Column, State);
end;

procedure TViewPrincipal.SpeedButton1Click(Sender: TObject);
//var
//  soma: Double;
//begin
//  ServiceConexao.FDQuery_transacoes.SQL.Text :=
//    'SELECT t.*, (SELECT SUM(tra_valor) FROM transacoes) AS soma_valor ' +
//    'FROM transacoes t';
//  ServiceConexao.FDQuery_transacoes.Open;
//
//  // Percorrendo os registros e exibindo os dados
//  while not ServiceConexao.FDQuery_transacoes.Eof do
//  begin
//    soma := ServiceConexao.FDQuery_transacoes.FieldByName('soma_valor').AsFloat;  // Recupera a soma
//    lblValorTotal.Caption := ' R$ ' + FloatToStr(soma);  // Exibe no Label
//  end;
//end;

var
  Soma: Double;
begin
  Soma := 0;

  // Certifique-se de que a Query esteja ativa antes de começar a somar
  if not ServiceConexao.FDQuery_transacoes.Active then
    ServiceConexao.FDQuery_transacoes.Open;

  // Move o ponteiro para o primeiro registro
  ServiceConexao.FDQuery_transacoes.First;

  // Percorre todos os registros e soma o valor do campo 'tra_valor'
  while not ServiceConexao.FDQuery_transacoes.Eof do
  begin
    Soma := Soma + ServiceConexao.FDQuery_transacoes.FieldByName('tra_valor').AsFloat;
    ServiceConexao.FDQuery_transacoes.Next;  // Move para o próximo registro
  end;

  // Exibe o resultado no Label
  lblValorTotal.Caption := ' R$: ' + FloatToStr(Soma);
end;


end.
